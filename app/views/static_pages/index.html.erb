<section class="todoapp">
    <header class="header">
        <h1>todos</h1>
        <form id="new-form">
            <input type='text' class="new-todo" />
        </form>
    </header>

    <section class="main">
        <ul class="todo-list">
        </ul>
    </section>
</section>

<script>
    $(function() {
        $('#new-form').submit(function(e) {
            e.preventDefault();

            var text = $('.new-todo').val();

            var payload = {
                task: {
                    title: text
                }
            };
            $.post("/tasks", payload).success(function(data) {
                console.log('successful post request');
            });
        });
        // takes a JS-representation of a task and generates HTML with li-tags for it
        function createTaskHTML(task) {
            var isChecked = task.done ? "checked" : "";
            var liElement = '<li><div class="view"><input class="toggle" type="checkbox"' +
                                    ' data-id="' + task.id + '" '+
                                    isChecked + '><label>' +
                                    task.title +
                                    '</label></div></li>';

            return liElement;
        }
        // called when a checkbox is toggled: will send the toggle-status to DB via JSON &
        // a put request
        function toggleTask(e) {
            var itemID = $(e.target).data("id");

            var isItemDone = Boolean($(e.target).is(':checked'));

            $.post("/tasks/" +itemID, {
                _method: "PUT",
                task: {
                    done: isItemDone
                }
            });
        }


        $.get("/tasks").success( function( data ) {
            var htmlString = "";

            $.each(data, function(index, task) {
                htmlString += createTaskHTML(task);
            });

            var ulTodos = $('.todo-list');
            ulTodos.html(htmlString);

            $('.toggle').change(toggleTask);
        });
    });
</script>